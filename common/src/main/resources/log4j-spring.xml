<Configuration status="WARN">
    <Properties>
        <!-- 应用名称，从环境变量读取，默认为 unknown -->
        <Property name="APP_NAME">${env:APP_NAME:-unknown}</Property>
        <Property name="APP_VERSION">${env:APP_VERSION:-unknown}</Property>
    </Properties>

    <Appenders>
        <!-- JSON 格式输出到控制台，供 Fluent Bit 收集 -->
        <Console name="JsonConsole" target="SYSTEM_OUT">
            <EcsLayout serviceName="${APP_NAME}" serviceVersion="${APP_VERSION}">
                <!-- 添加自定义字段 -->
                <KeyValuePair key="app" value="${APP_NAME}"/>
                <KeyValuePair key="version" value="${APP_VERSION}"/>
                <KeyValuePair key="trace_id" value="%X{traceId}"/>
                <KeyValuePair key="span_id" value="%X{spanId}"/>
                <KeyValuePair key="user_id" value="%X{userId}"/>
                <KeyValuePair key="request_path" value="%X{requestPath}"/>
            </EcsLayout>
        </Console>

        <Console name="HumanConsole" target="SYSTEM_OUT">
            <PatternLayout charset="UTF-8"
                           pattern="[%X{traceId}]%clr{%d{yyyy-MM-dd HH:mm:ss.SSS}}{faint} %clr{%5p} %clr{---}{faint} %clr{[%15.15t]}{faint} %clr{%-40.40c{1.}}{cyan} %clr{:}{faint} %m%n"/>
        </Console>
    </Appenders>

    <Loggers>
        <Root level="INFO">
            <!-- 默认使用 JSON 格式，可通过环境变量 LOG_FORMAT=human 切换为人类可读格式 -->
            <AppenderRef ref="${env:LOG_FORMAT:-JsonConsole}"/>
        </Root>
    </Loggers>
</Configuration>