# ä¸ªäººåšå®¢ç³»ç»Ÿ - é«˜æ€§èƒ½å¾®æœåŠ¡æ¶æ„

![Version](https://img.shields.io/badge/version-1.0Beta-blue)
![JDK](https://img.shields.io/badge/JDK-25-orange)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.10-brightgreen)
![Kotlin](https://img.shields.io/badge/Kotlin-2.3.0-purple)

è¯·æŸ¥çœ‹éƒ¨ç½²æ•™ç¨‹
[cainsglçš„å°ç«™](https://cainsgl.top/about/view/2025574517720674305)

ä¸€ä¸ªåŸºäºç°ä»£åŒ–æŠ€æœ¯æ ˆçš„é«˜æ€§èƒ½ä¸ªäººåšå®¢ç³»ç»Ÿï¼Œæ”¯æŒå•ä½“/å¾®æœåŠ¡æ¶æ„æ— ç¼åˆ‡æ¢ï¼Œé›†æˆAIèƒ½åŠ›ã€å‘é‡æ£€ç´¢ã€å…¨æ–‡æœç´¢ç­‰ç‰¹æ€§ã€‚

## æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ æ¶æ„è®¾è®¡
- **å•ä½“/å¾®æœåŠ¡å¯åˆ‡æ¢æ¶æ„**ï¼šå¼€å‘ç¯å¢ƒå•ä½“éƒ¨ç½²ï¼Œç”Ÿäº§ç¯å¢ƒK8så¾®æœåŠ¡éƒ¨ç½²
- **gRPCæœåŠ¡é€šä¿¡**ï¼šé«˜æ€§èƒ½RPCæ¡†æ¶ï¼Œæ”¯æŒæœåŠ¡é—´é€æ˜è°ƒç”¨
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šç”¨æˆ·ã€æ–‡ç« ã€AIã€è¯„è®ºã€æ–‡ä»¶ç­‰ä¸šåŠ¡æ¨¡å—å®Œå…¨è§£è€¦
- **è™šæ‹Ÿçº¿ç¨‹æ”¯æŒ**ï¼šåŸºäºJDK 21+è™šæ‹Ÿçº¿ç¨‹ï¼Œå¤§å¹…æå‡å¹¶å‘å¤„ç†èƒ½åŠ›

### ğŸš€ æ€§èƒ½ä¼˜åŒ–
- **çƒ­ç‚¹Keyæ¢æµ‹**ï¼šåŸºäºLuaè„šæœ¬çš„å®æ—¶çƒ­ç‚¹æ•°æ®è¯†åˆ«ï¼ˆ2ç§’çª—å£ï¼Œ8æ¬¡é˜ˆå€¼ï¼‰
- **å¤šçº§ç¼“å­˜æ¶æ„**ï¼šæœ¬åœ°ç¼“å­˜ + Redisç¼“å­˜ + æ•°æ®åº“ï¼Œç¼“å­˜å‘½ä¸­ç‡95%+
- **ç»†ç²’åº¦é”æœºåˆ¶**ï¼šé¿å…ç¼“å­˜å‡»ç©¿ï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥é” + ç»†ç²’åº¦é”æ± 
- **æ‰¹é‡å¤„ç†ä¼˜åŒ–**ï¼šæ—¥å¿—ã€è®¡æ•°å™¨ç­‰é«˜é¢‘å†™æ“ä½œæ‰¹é‡å…¥åº“ï¼Œå‡å°‘DBå‹åŠ›
- **å»¶è¿Ÿé˜Ÿåˆ—**ï¼šåŸºäºRedis Sorted Setå®ç°çš„å»¶è¿Ÿä»»åŠ¡é˜Ÿåˆ—

### ğŸ¤– AIèƒ½åŠ›é›†æˆ
- **å‘é‡åŒ–æ£€ç´¢ï¼ˆRAGï¼‰**ï¼šæ–‡ç« å†…å®¹æ™ºèƒ½åˆ†å— + Embeddingå‘é‡åŒ–
- **è¯­ä¹‰æœç´¢**ï¼šåŸºäºPostgreSQL pgvectorçš„ç›¸ä¼¼åº¦æœç´¢
- **æ™ºèƒ½æ ‡ç­¾ç”Ÿæˆ**ï¼šAIè‡ªåŠ¨åˆ†ææ–‡ç« å†…å®¹ç”Ÿæˆæ ‡ç­¾
- **å†…å®¹æ‘˜è¦**ï¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ç« æ‘˜è¦
- **AIå¯¹è¯**ï¼šé›†æˆç«å±±å¼•æ“è±†åŒ…å¤§æ¨¡å‹ï¼Œæ”¯æŒSSEæµå¼å“åº”

### ğŸ” æœç´¢èƒ½åŠ›
- **å…¨æ–‡æœç´¢**ï¼šElasticsearch + IKåˆ†è¯å™¨ï¼Œæ”¯æŒé«˜äº®æ˜¾ç¤º
- **å‘é‡æ£€ç´¢**ï¼šåŸºäºä½™å¼¦ç›¸ä¼¼åº¦çš„è¯­ä¹‰æœç´¢
- **æ··åˆæ£€ç´¢**ï¼šå…¨æ–‡æœç´¢ + å‘é‡æ£€ç´¢ç»“åˆï¼Œæå‡å¬å›ç‡

### ğŸ“Š æŠ€æœ¯æ ˆ

**åç«¯æ¡†æ¶**
- Spring Boot 3.5.10 + Kotlin 2.3.0
- MyBatis-Plusï¼ˆæ•°æ®è®¿é—®å±‚ï¼‰
- gRPC 3.1.0ï¼ˆå¾®æœåŠ¡é€šä¿¡ï¼‰
- Sa-Tokenï¼ˆè®¤è¯æˆæƒï¼‰

**æ•°æ®å­˜å‚¨**
- PostgreSQLï¼ˆä¸»æ•°æ®åº“ï¼Œæ”¯æŒpgvectoræ‰©å±•ï¼‰
- Redisï¼ˆç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
- Elasticsearchï¼ˆå…¨æ–‡æœç´¢ï¼‰

**æ¶ˆæ¯é˜Ÿåˆ—**
- RocketMQï¼ˆå¼‚æ­¥æ¶ˆæ¯å¤„ç†ï¼‰

**AIèƒ½åŠ›**
- Spring AIï¼ˆç»Ÿä¸€AIæ¥å£ï¼‰
- ç«å±±å¼•æ“è±†åŒ…å¤§æ¨¡å‹ï¼ˆå¯¹è¯ + Embeddingï¼‰

**è¿ç»´éƒ¨ç½²**
- Docker + Kubernetes
- Fluent Bitï¼ˆæ—¥å¿—é‡‡é›†ï¼‰
- Prometheus + Grafanaï¼ˆç›‘æ§ï¼‰

## æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. çƒ­ç‚¹Keyæ¢æµ‹æœºåˆ¶

åŸºäºRedis + Luaè„šæœ¬å®ç°çš„å®æ—¶çƒ­ç‚¹æ•°æ®è¯†åˆ«ï¼Œé¿å…ç¼“å­˜å‡»ç©¿å’Œé›ªå´©ã€‚

**å®ç°åŸç†**
```kotlin
// æ—¶é—´çª—å£å†…è®¿é—®æ¬¡æ•°è¶…è¿‡é˜ˆå€¼åˆ™åˆ¤å®šä¸ºçƒ­ç‚¹Key
const val HOT_KEY_COUNT_THRESHOLD = 8L
const val TIME_WINDOW_SECONDS = 2L

// Luaè„šæœ¬ä¿è¯åŸå­æ€§
local count = redis.call('INCR', KEYS[1])
if count == 1 then
    redis.call('EXPIRE', KEYS[1], ARGV[1])
end
if count >= tonumber(ARGV[2]) then
    return 1  -- çƒ­ç‚¹Key
else
    return 0
end
```

**åº”ç”¨åœºæ™¯**
- æ–‡ç« è¯¦æƒ…é«˜å¹¶å‘è®¿é—®
- ç”¨æˆ·ä¿¡æ¯é¢‘ç¹æŸ¥è¯¢
- çƒ­é—¨è¯„è®ºåŠ è½½

### 2. å¤šçº§ç¼“å­˜æ¶æ„

é‡‡ç”¨ç»†ç²’åº¦é” + åŒé‡æ£€æŸ¥é”æœºåˆ¶ï¼Œé¿å…ç¼“å­˜å‡»ç©¿ã€‚

**ç¼“å­˜å±‚çº§**
1. **æœ¬åœ°ç¼“å­˜**ï¼šç»†ç²’åº¦é”æ± ï¼ˆConcurrentHashMapï¼‰
2. **Redisç¼“å­˜**ï¼šçƒ­ç‚¹æ•°æ®ç¼“å­˜ï¼ˆ10-60åˆ†é’ŸTTLï¼‰
3. **æ•°æ®åº“**ï¼šæœ€ç»ˆæ•°æ®æº

**æ ¸å¿ƒä»£ç **
```kotlin
fun <T> getWithFineLock(cacheKey: String, loader: () -> T?): T? {
    // ç¬¬ä¸€æ¬¡æ£€æŸ¥ç¼“å­˜
    val cacheData = redis.get(cacheKey)
    if (cacheData != null) return cacheData
    
    // çƒ­ç‚¹Keyæ‰åŠ é”
    if (hotKeyValidator.isHotKey(cacheKey)) {
        return withFineLock(cacheKey) {
            // åŒé‡æ£€æŸ¥
            redis.get(cacheKey) ?: loader()?.also { 
                redis.set(cacheKey, it, ttl) 
            }
        }
    }
    return loader()
}
```

**æ€§èƒ½æå‡**
- ç¼“å­˜å‘½ä¸­ç‡ï¼š95%+
- P99å“åº”æ—¶é—´ï¼š< 50ms
- é¿å…ç¼“å­˜å‡»ç©¿å¯¼è‡´çš„æ•°æ®åº“å‹åŠ›

### 3. æ‰¹é‡å¤„ç†ä¼˜åŒ–

é«˜é¢‘å†™æ“ä½œï¼ˆæµè§ˆé‡ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°ï¼‰å…ˆå†™Redisï¼Œå®šæ—¶æ‰¹é‡åˆ·å…¥æ•°æ®åº“ã€‚

**å®ç°æ–¹æ¡ˆ**
```kotlin
// ç´¯ç§¯åˆ°æŒ‡å®šæ•°é‡åæ‰¹é‡æ›´æ–°
class BatchPostCountUpdater(batchSize: Int = 10) {
    private val updateBatch = mutableListOf<Triple<Long, String, Long>>()
    
    fun update(postId: Long, type: String, count: Long) {
        updateBatch.add(Triple(postId, type, count))
        if (updateBatch.size >= batchSize) {
            flush()  // æ‰¹é‡å†™å…¥æ•°æ®åº“
        }
    }
}
```

**æ‰¹é‡æ›´æ–°SQL**
```sql
-- ä½¿ç”¨CASE WHENå®ç°æ‰¹é‡å¢é‡æ›´æ–°
UPDATE posts SET
  view_count = CASE 
    WHEN id = 1 THEN view_count + 10
    WHEN id = 2 THEN view_count + 5
    ...
  END
WHERE id IN (1, 2, ...)
```

**ä¼˜åŒ–æ•ˆæœ**
- æ•°æ®åº“å†™å…¥æ¬¡æ•°å‡å°‘90%
- TPSæå‡10å€
- æ•°æ®åº“è¿æ¥æ± å‹åŠ›é™ä½

### 4. å»¶è¿Ÿé˜Ÿåˆ—å®ç°

åŸºäºRedis Sorted Setå®ç°çš„å»¶è¿Ÿä»»åŠ¡é˜Ÿåˆ—ï¼Œç”¨äºæ–‡ä»¶éªŒè¯ã€å®šæ—¶ä»»åŠ¡ç­‰åœºæ™¯ã€‚

**æ ¸å¿ƒå®ç°**
```kotlin
class DelayedTaskQueue {
    // æ·»åŠ ä»»åŠ¡ï¼ˆscoreä¸ºæ‰§è¡Œæ—¶é—´æˆ³ï¼‰
    fun addTask(taskId: Long, delaySeconds: Long) {
        val executeTime = Instant.now().epochSecond + delaySeconds
        redis.zAdd(QUEUE_KEY, taskId.toString(), executeTime.toDouble())
    }
    
    // è·å–åˆ°æœŸä»»åŠ¡
    fun pollDueTasks(batchSize: Int = 100): List<Long> {
        val now = Instant.now().epochSecond.toDouble()
        return redis.zRangeByScore(QUEUE_KEY, 0.0, now, 0, batchSize)
    }
}
```

**åº”ç”¨åœºæ™¯**
- æ–‡ä»¶ä¸Šä¼ åå»¶è¿ŸéªŒè¯ï¼ˆé˜²æ­¢æ¶æ„ä¸Šä¼ ï¼‰
- è®¢å•è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ
- å®šæ—¶æ¶ˆæ¯æ¨é€

### 5. å‘é‡æ£€ç´¢ï¼ˆRAGï¼‰

åŸºäºPostgreSQL pgvectoræ‰©å±•å®ç°çš„è¯­ä¹‰æœç´¢ï¼Œæ”¯æŒæ–‡ç« ç›¸ä¼¼åº¦æ¨èã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**
1. **æ–‡ç« åˆ†å—**ï¼šGFM Markdownæ™ºèƒ½åˆ‡åˆ†ï¼ˆ500-2000å­—ç¬¦åŸºç¡€å—ï¼‰
2. **å‘é‡åŒ–**ï¼šSpring AI + ç«å±±å¼•æ“Embeddingæ¨¡å‹ï¼ˆ1024ç»´ï¼‰
3. **é™ç»´ä¼˜åŒ–**ï¼šPCAé™ç»´ + å½’ä¸€åŒ–
4. **ç›¸ä¼¼åº¦è®¡ç®—**ï¼šä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆCosine Similarityï¼‰

**åˆ†å—ç­–ç•¥**
```kotlin
object GfmChunkUtils {
    // è§„åˆ™ï¼šGFM â†’ çº¯æ–‡æœ¬ â†’ åŸºç¡€å—(500-2000å­—ç¬¦) â†’ å­å—(4-5å¥è¯)
    fun chunk(gfmContent: String): List<String> {
        val document = parser.parse(gfmContent)
        val plainTexts = extractPlainTexts(document)
        val baseChunks = mergeToBaseChunks(plainTexts)  // 500-2000å­—ç¬¦
        return baseChunks.flatMap { splitToSubChunks(it) }  // 4-5å¥è¯
    }
}
```

**å‘é‡æ£€ç´¢æµç¨‹**
```
ç”¨æˆ·æŸ¥è¯¢ â†’ Embeddingå‘é‡åŒ– â†’ pgvectorä½™å¼¦ç›¸ä¼¼åº¦æœç´¢ 
â†’ åŠ æƒèšåˆï¼ˆè·ç¦» + å‘½ä¸­æ•°ï¼‰ â†’ è¿”å›Top Kç›¸ä¼¼æ–‡ç« 
```

**èšåˆç®—æ³•**
```kotlin
// èšåˆå¾—åˆ† = minDistance / (1 + ln(1 + hitCount))
// å‘½ä¸­chunkè¶Šå¤šã€è·ç¦»è¶Šå°ï¼Œå¾—åˆ†è¶Šä½ï¼ˆè¶Šç›¸ä¼¼ï¼‰
val aggregatedScore = minDistance / (1 + ln(1.0 + hitCount))
```

### 6. å…¨æ–‡æœç´¢

Elasticsearch + IKåˆ†è¯å™¨å®ç°çš„å…¨æ–‡æœç´¢ï¼Œæ”¯æŒæ ‡é¢˜ã€å†…å®¹ã€æ ‡ç­¾å¤šå­—æ®µæ£€ç´¢ã€‚

**ç´¢å¼•è®¾è®¡**
```kotlin
@Document(indexName = "posts")
data class PostDocument(
    @Field(type = FieldType.Text, 
           analyzer = "ik_max_word",      // ç´¢å¼•æ—¶ç»†ç²’åº¦åˆ†è¯
           searchAnalyzer = "ik_smart")   // æœç´¢æ—¶ç²—ç²’åº¦åˆ†è¯
    var title: String,
    
    @Field(type = FieldType.Text, analyzer = "ik_smart")
    var content: String?,
    
    @Field(type = FieldType.Keyword)  // ç²¾ç¡®åŒ¹é…
    var tags: List<String>?
)
```

**æœç´¢ç­–ç•¥**
- æ ‡é¢˜åŒ¹é…ï¼šæƒé‡3.0ï¼ˆæœ€é«˜ï¼‰
- æ‘˜è¦åŒ¹é…ï¼šæƒé‡2.0
- æ ‡ç­¾åŒ¹é…ï¼šæƒé‡2.5ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
- å†…å®¹åŒ¹é…ï¼šæƒé‡1.0

**é«˜äº®æ˜¾ç¤º**
```kotlin
val highlight = Highlight(
    HighlightParameters.builder()
        .withPreTags("<em>")
        .withPostTags("</em>")
        .build()
)
```

### 7. è¿ç¦è¯çƒ­æ›´æ–°

åŸºäºæ–‡ä»¶ç›‘å¬çš„è¿ç¦è¯çƒ­æ›´æ–°æœºåˆ¶ï¼Œæ— éœ€é‡å¯æœåŠ¡å³å¯æ›´æ–°æ•æ„Ÿè¯åº“ã€‚

**å®ç°åŸç†**
```kotlin
@Component
class SensitiveWord {
    private val current = AtomicReference<SensitiveWordBs>()
    
    @PostConstruct
    fun init() {
        // åŠ è½½æ•æ„Ÿè¯æ–‡ä»¶
        current.set(createBs(loadWords(file)))
        
        // ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ˆæ¯5ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
        val monitor = FileAlterationMonitor(5000)
        monitor.addObserver(FileAlterationObserver(file.parentFile).apply {
            addListener(object : FileAlterationListenerAdaptor() {
                override fun onFileChange(changedFile: File) {
                    if (changedFile == file) {
                        current.set(createBs(loadWords(file)))  // çƒ­æ›´æ–°
                    }
                }
            })
        })
        monitor.start()
    }
}
```

**ç‰¹æ€§**
- æ”¯æŒK8s ConfigMapæŒ‚è½½
- æ— éœ€é‡å¯æœåŠ¡
- åŸå­æ€§æ›´æ–°ï¼ˆAtomicReferenceï¼‰

### 8. æ—¥å¿—æ‰¹é‡å¤„ç†

æ¶ˆæ¯é˜Ÿåˆ— + æ‰¹é‡å¤„ç†ï¼Œå‡å°‘æ•°æ®åº“å†™å…¥å‹åŠ›ã€‚

**å¤„ç†æµç¨‹**
```
RocketMQæ¶ˆæ¯ â†’ ç´¯ç§¯åˆ°é˜ˆå€¼(30æ¡) â†’ æ‰¹é‡å¤„ç† â†’ åˆå¹¶PostProcessor â†’ æ‰¹é‡å…¥åº“
```

**æ ¸å¿ƒä»£ç **
```kotlin
@Component
class LogPipelineManager {
    @Value("\${userLog.batchNumber}")
    var batchNumber: Int = 30  // æ‰¹é‡å¤„ç†é˜ˆå€¼
    
    fun accumulate(logs: List<UserLogEntity>): LogPipeline? {
        backlogLogs.addAll(logs)
        if (backlogLogs.size > batchNumber) {
            val pipeline = LogPipeline(backlogLogs, handlerMap)
            backlogLogs.clear()
            return pipeline
        }
        return null
    }
}
```

**ä¼˜åŒ–æ•ˆæœ**
- æ•°æ®åº“å†™å…¥æ¬¡æ•°å‡å°‘95%
- æ—¥å¿—å¤„ç†å»¶è¿Ÿ < 1ç§’
- æ”¯æŒPostProcessoråˆå¹¶ä¼˜åŒ–

### 9. ç©ºé—²æ—¶èµ„æºä¼˜åŒ–

åŸºäºCPUè´Ÿè½½ç›‘æ§çš„æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ï¼Œåœ¨ç³»ç»Ÿç©ºé—²æ—¶æ‰§è¡Œæ•°æ®åŒæ­¥ä»»åŠ¡ã€‚

**å®ç°åŸç†**
```kotlin
@Component
class PostIdleTriggeredTask {
    @Value("\${idle.task.cpu-threshold:70.0}")
    private val cpuThreshold = 70.0  // CPUä½¿ç”¨ç‡ä½äº70%æ—¶æ‰§è¡Œ
    
    @Scheduled(fixedRate = 30000)  // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    fun checkIdleAndExecute() {
        val cpuUsage = getCpuUsage()
        if (cpuUsage < cpuThreshold) {
            syncPostCountToDatabase()  // åŒæ­¥Redisæ•°æ®åˆ°æ•°æ®åº“
        }
    }
}
```

**ä¼˜åŒ–æ•ˆæœ**
- é¿å…é«˜å³°æœŸæ•°æ®åº“å‹åŠ›
- å……åˆ†åˆ©ç”¨ç³»ç»Ÿç©ºé—²èµ„æº
- æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ä¿è¯

## æ¶æ„è®¾è®¡

### å•ä½“/å¾®æœåŠ¡åˆ‡æ¢æ¶æ„

**æ ¸å¿ƒæ€æƒ³**ï¼šé€šè¿‡gRPCä»£ç†å±‚å®ç°é€æ˜åˆ‡æ¢ï¼Œå¼€å‘ç¯å¢ƒå•ä½“éƒ¨ç½²ï¼Œç”Ÿäº§ç¯å¢ƒå¾®æœåŠ¡éƒ¨ç½²ã€‚

**å®ç°æ–¹æ¡ˆ**
```kotlin
// 1. å®šä¹‰æœåŠ¡æ¥å£
interface UserService {
    fun getById(id: Long): UserEntity?
}

// 2. æœ¬åœ°å®ç°ï¼ˆå•ä½“æ¶æ„ï¼‰
@Service
class UserServiceImpl : UserService {
    override fun getById(id: Long): UserEntity? {
        return baseMapper.selectById(id)
    }
}

// 3. gRPCä»£ç†å®ç°ï¼ˆå¾®æœåŠ¡æ¶æ„ï¼‰
@Service
@ConditionalOnMissingBean(type = "com.cainsgl.user.service.UserServiceImpl")
class UserGrpcService : UserService {
    override fun getById(id: Long): UserEntity? {
        return grpcStub.getUser(id)  // è¿œç¨‹è°ƒç”¨
    }
}
```

**åˆ‡æ¢æ–¹å¼**
- å•ä½“æ¶æ„ï¼šæ‰€æœ‰æ¨¡å—æ‰“åŒ…åˆ°aggregateæ¨¡å—ï¼Œæœ¬åœ°è°ƒç”¨
- å¾®æœåŠ¡æ¶æ„ï¼šå„æ¨¡å—ç‹¬ç«‹éƒ¨ç½²ï¼ŒgRPCé€šä¿¡

### æœåŠ¡æ‰©å±•è§„èŒƒ

å¦‚ä½•æ‰©å±•ä¸€ä¸ªæ–°çš„Serviceï¼Ÿ

1. åœ¨`common/proto`ä¸‹åˆ›å»ºprotoæ–‡ä»¶ï¼Œå®šä¹‰gRPCæ¥å£
2. ä½¿ç”¨Mavenç¼–è¯‘è‡ªåŠ¨ç”ŸæˆgRPCç±»
3. åœ¨ä¸šåŠ¡æ¨¡å—çš„`api`åŒ…ä¸‹ç»§æ‰¿ç”Ÿæˆçš„gRPCç±»ï¼Œå®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨`common/service`ä¸‹åˆ›å»ºæœåŠ¡æ¥å£
5. åœ¨ä¸šåŠ¡æ¨¡å—åˆ›å»ºæœ¬åœ°å®ç°ï¼ˆ`xxxServiceImpl`ï¼Œæ³¨è§£`@Service`ï¼‰
6. åœ¨`common`åˆ›å»ºgRPCä»£ç†ï¼ˆ`xxxGrpcService`ï¼Œæ³¨è§£`@Service` + `@ConditionalOnMissingBean`ï¼‰
7. åœ¨`common/application.yml`é…ç½®gRPCæœåŠ¡åœ°å€

è¯¦æƒ…è¯·æŸ¥çœ‹`GRPC_GENERATOR_PROMPT.md`

## æ€§èƒ½æŒ‡æ ‡

### ç¼“å­˜æ€§èƒ½
- ç¼“å­˜å‘½ä¸­ç‡ï¼š95%+
- Rediså“åº”æ—¶é—´ï¼šP99 < 5ms
- çƒ­ç‚¹Keyè¯†åˆ«å‡†ç¡®ç‡ï¼š98%+

### æ¥å£æ€§èƒ½
- æ–‡ç« è¯¦æƒ…æ¥å£ï¼šP99 < 50ms
- æ–‡ç« åˆ—è¡¨æ¥å£ï¼šP99 < 100ms
- æœç´¢æ¥å£ï¼šP99 < 200ms

### å¹¶å‘èƒ½åŠ›
- å•æœºQPSï¼š10000+ï¼ˆæ–‡ç« è¯¦æƒ…ï¼‰
- å¹¶å‘ç”¨æˆ·æ•°ï¼š5000+
- æ•°æ®åº“è¿æ¥æ± ï¼šæœ€å¤§50ï¼Œæœ€å°10

### èµ„æºä¼˜åŒ–
- æ•°æ®åº“å†™å…¥æ¬¡æ•°å‡å°‘ï¼š90%+
- æ—¥å¿—å¤„ç†å»¶è¿Ÿï¼š< 1ç§’
- CPUç©ºé—²æ—¶è‡ªåŠ¨åŒæ­¥æ•°æ®

## éƒ¨ç½²æ–¹æ¡ˆ

### å•ä½“æ¶æ„éƒ¨ç½²

**é€‚ç”¨åœºæ™¯**ï¼šå¼€å‘ç¯å¢ƒã€å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ

```bash
# 1. æ‰“åŒ…
mvn clean package -DskipTests

# 2. è¿è¡Œ
java -jar aggregate/target/aggregate-1.0.jar
```

**ç‰¹ç‚¹**
- æ‰€æœ‰APIå‰ç¼€ä¸º`/api`
- æœ¬åœ°æ–¹æ³•è°ƒç”¨ï¼Œæ€§èƒ½æœ€ä¼˜
- éƒ¨ç½²ç®€å•ï¼Œé€‚åˆå¿«é€Ÿè¿­ä»£

### å¾®æœåŠ¡æ¶æ„éƒ¨ç½²

**é€‚ç”¨åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒã€é«˜å¹¶å‘åœºæ™¯

**K8séƒ¨ç½²æ¸…å•**
```yaml
# user-service.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-service
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: user-service
        image: blog/user-service:1.0
        ports:
        - containerPort: 8080  # HTTP
        - containerPort: 9090  # gRPC
        env:
        - name: SPRING_PROFILES_ACTIVE
          value: "prod"
```

**æœåŠ¡å‘ç°**
- K8s Serviceå®ç°æœåŠ¡å‘ç°
- gRPCè´Ÿè½½å‡è¡¡
- å¥åº·æ£€æŸ¥ï¼ˆLiveness + Readinessï¼‰

### ä¸­é—´ä»¶éƒ¨ç½²

**PostgreSQL**
```yaml
# å¯ç”¨pgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

# åˆ›å»ºå‘é‡ç´¢å¼•
CREATE INDEX ON post_chunk_vector 
USING ivfflat (vector vector_cosine_ops) 
WITH (lists = 100);
```

**Elasticsearch**
```yaml
# å®‰è£…IKåˆ†è¯å™¨
elasticsearch-plugin install \
  https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v8.x/elasticsearch-analysis-ik-8.x.zip
```

**Redis**
```yaml
# é…ç½®æŒä¹…åŒ–
appendonly yes
appendfsync everysec
```

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—é‡‡é›†

**Fluent Bité…ç½®**
```yaml
[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Parser            json
    Tag               app.log

[OUTPUT]
    Name              es
    Match             app.log
    Host              elasticsearch
    Port              9200
    Index             app-logs
```

### å¥åº·æ£€æŸ¥

**Spring Boot Actuator**
```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true
```

**K8sæ¢é’ˆ**
```yaml
livenessProbe:
  httpGet:
    path: /api/actuator/health/liveness
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /api/actuator/health/readiness
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5
```

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- ä½¿ç”¨Kotlinç¼–å†™ä¸šåŠ¡ä»£ç 
- éµå¾ªSpring Bootæœ€ä½³å®è·µ
- ä½¿ç”¨Kotlinåç¨‹å¤„ç†å¼‚æ­¥ä»»åŠ¡

### æ•°æ®åº“è§„èŒƒ
- æ‰€æœ‰è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆï¼‰
- ä½¿ç”¨MyBatis-Plusçš„Kotlinæ‰©å±•
- æ•æ„Ÿå­—æ®µåŠ å¯†å­˜å‚¨

### ç¼“å­˜è§„èŒƒ
- çƒ­ç‚¹æ•°æ®å¿…é¡»ä½¿ç”¨çƒ­ç‚¹Keyæ¢æµ‹
- ç¼“å­˜Keyç»Ÿä¸€å‰ç¼€ç®¡ç†
- è®¾ç½®åˆç†çš„TTLï¼ˆ10-60åˆ†é’Ÿï¼‰

### APIè§„èŒƒ
- RESTful APIè®¾è®¡
- ç»Ÿä¸€è¿”å›æ ¼å¼ï¼ˆResultå°è£…ï¼‰
- å¼‚å¸¸ç»Ÿä¸€å¤„ç†

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- JDK 25+
- Maven 3.8+
- PostgreSQL 14+ï¼ˆéœ€å®‰è£…pgvectoræ‰©å±•ï¼‰
- Redis 6.0+
- Elasticsearch 8.x+ï¼ˆéœ€å®‰è£…IKåˆ†è¯å™¨ï¼‰
- RocketMQ 5.x+

### æœ¬åœ°å¼€å‘

1. **å…‹éš†é¡¹ç›®**
```bash
git clone https://github.com/your-repo/blog-backend.git
cd blog-backend
```

2. **é…ç½®æ•°æ®åº“**
```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE blog;

-- å¯ç”¨pgvectoræ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- å¯¼å…¥SQLè„šæœ¬
psql -U postgres -d blog -f cainsgl-blog.sql
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
```yaml
# common/src/main/resources/env.yaml
db:
  url: jdbc:postgresql://localhost:5432/blog
  username: postgres
  password: your_password

redis:
  host: localhost
  port: 6379
  password: your_password

es:
  uris: http://localhost:9200
  username: elastic
  password: your_password

ai:
  base-url: https://ark.cn-beijing.volces.com/api/v3
  api-key: your_api_key
```

4. **ç¼–è¯‘é¡¹ç›®**
```bash
# ç”ŸæˆgRPCä»£ç 
mvn clean compile

# æ‰“åŒ…
mvn clean package -DskipTests
```

5. **è¿è¡Œï¼ˆå•ä½“æ¶æ„ï¼‰**
```bash
java -jar aggregate/target/aggregate-1.0.jar
```

6. **è®¿é—®**
- APIåœ°å€ï¼šhttp://localhost:8080/api
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8080/api/actuator/health

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t blog-backend:1.0 .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8080:8080 \
  -p 9090:9090 \
  -e SPRING_PROFILES_ACTIVE=prod \
  blog-backend:1.0
```

## è¸©å‘è®°å½•

### 1. Lombokç¼–è¯‘å™¨æœªè®¾ç½®
**é—®é¢˜**ï¼šSetterç­‰æ–¹æ³•å¤±æ•ˆï¼Œå¯¼è‡´é…ç½®æ³¨å…¥å¤±è´¥

**åŸå› **ï¼šæœªåœ¨IDEAä¸­å¯ç”¨Lombokæ³¨è§£å¤„ç†å™¨

**è§£å†³**ï¼š
```
Settings â†’ Build, Execution, Deployment â†’ Compiler â†’ Annotation Processors
å‹¾é€‰ "Enable annotation processing"
```

### 2. Commonæ¨¡å—é…ç½®æ–‡ä»¶å†²çª
**é—®é¢˜**ï¼šæ‰“åŒ…åcommonæ¨¡å—çš„application.ymlè¢«è¦†ç›–ï¼Œé…ç½®å…¨éƒ¨å¤±æ•ˆ

**åŸå› **ï¼šå¤šä¸ªæ¨¡å—çš„application.ymlæ–‡ä»¶åå†²çª

**è§£å†³**ï¼šå°†commonæ¨¡å—çš„é…ç½®æ–‡ä»¶æ”¹ä¸º`application-common.yml`ï¼Œé¿å…å†²çª

### 3. Logstashæ—¥å¿—æ— æ³•å†™å…¥ES
**é—®é¢˜**ï¼šæ—¥å¿—å§‹ç»ˆæ— æ³•è®°å½•åˆ°Elasticsearch

**åŸå› **ï¼šHelmå®‰è£…çš„Logstashç«¯å£æ˜ å°„é”™è¯¯ï¼ˆé»˜è®¤5044ï¼Œé…ç½®å´æ˜¯å…¶ä»–ç«¯å£ï¼‰

**è§£å†³**ï¼šæ£€æŸ¥ç«¯å£æ˜ å°„ï¼Œç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£ä¸å®é™…ç›‘å¬ç«¯å£ä¸€è‡´

### 4. gRPCæ–¹æ³•æ‰¾ä¸åˆ°
**é—®é¢˜**ï¼šæŠ¥é”™`UNIMPLEMENTED: Method not found: com.cainsgl.grpc`

**åŸå› **ï¼šgRPCå®¢æˆ·ç«¯åœ°å€çš„ç«¯å£é…ç½®é”™è¯¯ï¼ˆDockeræ˜ å°„9093ï¼Œé…ç½®å´æ˜¯9092ï¼‰

**è§£å†³**ï¼šæ£€æŸ¥gRPCæœåŠ¡ç«¯å£é…ç½®ï¼Œç¡®ä¿å®¢æˆ·ç«¯è¿æ¥æ­£ç¡®çš„ç«¯å£

### 5. MyBatisç‰ˆæœ¬å†²çª
**é—®é¢˜**ï¼šæŠ¥Stringç±»å‹é”™è¯¯

**åŸå› **ï¼šè¯¯å¼•å…¥JPAå¯¼è‡´SqlSessionåˆ›å»ºå†²çªï¼Œç§»é™¤åAIå°†MyBatisä»Boot3é™çº§åˆ°1.x

**è§£å†³**ï¼š
- ç§»é™¤JPAä¾èµ–
- ç¡®ä¿ä½¿ç”¨MyBatis-Plus 3.5.xç‰ˆæœ¬
- æ£€æŸ¥ä¾èµ–æ ‘ï¼Œé¿å…ç‰ˆæœ¬å†²çª

### 6. Jacksonæ³¨è§£å¤±æ•ˆ
**é—®é¢˜**ï¼š`@JsonSerialize`ç­‰æ³¨è§£ä¸ç”Ÿæ•ˆ

**åŸå› **ï¼šç¼ºå°‘Jacksonç›¸å…³ä¾èµ–

**è§£å†³**ï¼šå¼•å…¥`jackson-databind`å’Œ`jackson-annotations`ä¾èµ–

### 7. å‰ç«¯IDç²¾åº¦æŸå¤±
**é—®é¢˜**ï¼šLongç±»å‹IDä¼ åˆ°å‰ç«¯åç²¾åº¦ä¸¢å¤±

**åŸå› **ï¼šJavaScriptçš„Numberç±»å‹æœ€å¤§å®‰å…¨æ•´æ•°ä¸º2^53-1

**è§£å†³**ï¼š
```kotlin
@JsonSerialize(using = ToStringSerializer::class)
var id: Long
```

### 8. å‘é‡æœç´¢å¤±æ•ˆ
**é—®é¢˜**ï¼šæŸä¸ªç‰ˆæœ¬åæ— æ³•è¿›è¡Œå‘é‡æœç´¢

**åŸå› **ï¼šVectorHandlerçš„å­—ç¬¦ä¸²ä»`halfvector`è¢«æ”¹æˆ`vector`

**è§£å†³**ï¼šæ£€æŸ¥TypeHandleré…ç½®ï¼Œç¡®ä¿ä¸æ•°æ®åº“å­—æ®µç±»å‹ä¸€è‡´

### 9. Redisè¿æ¥æ± è€—å°½
**é—®é¢˜**ï¼šé«˜å¹¶å‘ä¸‹Redisè¿æ¥æ± è€—å°½

**åŸå› **ï¼šé»˜è®¤è¿æ¥æ± é…ç½®è¿‡å°

**è§£å†³**ï¼š
```yaml
spring:
  data:
    redis:
      jedis:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2
```

### 10. ESè¿æ¥é‡ç½®
**é—®é¢˜**ï¼šElasticsearchå¶å°”æŠ¥`Connection reset`é”™è¯¯

**åŸå› **ï¼šç½‘ç»œä¸ç¨³å®šæˆ–ESè´Ÿè½½è¿‡é«˜

**è§£å†³**ï¼šå®ç°é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
```kotlin
private fun <T> retryOnConnectionReset(maxRetries: Int = 3, block: () -> T): T {
    repeat(maxRetries) { attempt ->
        try {
            return block()
        } catch (e: DataAccessResourceFailureException) {
            if (e.message?.contains("Connection reset") == true) {
                Thread.sleep(500 * (attempt + 1))  // æŒ‡æ•°é€€é¿
            } else throw e
        }
    }
}
```

## é¡¹ç›®äº®ç‚¹æ€»ç»“

### æŠ€æœ¯åˆ›æ–°
1. **çƒ­ç‚¹Keyæ¢æµ‹**ï¼šåŸºäºLuaè„šæœ¬çš„å®æ—¶çƒ­ç‚¹è¯†åˆ«ï¼Œé¿å…ç¼“å­˜å‡»ç©¿
2. **ç»†ç²’åº¦é”**ï¼šé”æ±  + åŒé‡æ£€æŸ¥é”ï¼Œæ€§èƒ½ä¼˜äºä¼ ç»Ÿåˆ†å¸ƒå¼é”
3. **æ™ºèƒ½åˆ†å—**ï¼šGFM Markdownè¯­ä¹‰æ„ŸçŸ¥åˆ†å—ï¼Œæå‡å‘é‡æ£€ç´¢å‡†ç¡®ç‡
4. **ç©ºé—²è°ƒåº¦**ï¼šåŸºäºCPUè´Ÿè½½çš„æ™ºèƒ½ä»»åŠ¡è°ƒåº¦ï¼Œå……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æº
5. **æ‰¹é‡ä¼˜åŒ–**ï¼šå¤šç§æ‰¹é‡å¤„ç†ç­–ç•¥ï¼Œæ•°æ®åº“å†™å…¥æ¬¡æ•°å‡å°‘90%+

### æ¶æ„ä¼˜åŠ¿
1. **å•ä½“/å¾®æœåŠ¡åˆ‡æ¢**ï¼šä¸€å¥—ä»£ç ï¼Œä¸¤ç§éƒ¨ç½²æ–¹å¼
2. **gRPCé€šä¿¡**ï¼šé«˜æ€§èƒ½RPCï¼Œæ”¯æŒæµå¼ä¼ è¾“
3. **è™šæ‹Ÿçº¿ç¨‹**ï¼šJDK 21+ç‰¹æ€§ï¼Œå¤§å¹…æå‡å¹¶å‘èƒ½åŠ›
4. **æ¨¡å—åŒ–è®¾è®¡**ï¼šä¸šåŠ¡æ¨¡å—å®Œå…¨è§£è€¦ï¼Œæ˜“äºæ‰©å±•

### AIèƒ½åŠ›
1. **å‘é‡æ£€ç´¢ï¼ˆRAGï¼‰**ï¼šè¯­ä¹‰æœç´¢ + ç›¸ä¼¼æ–‡ç« æ¨è
2. **æ™ºèƒ½æ ‡ç­¾**ï¼šAIè‡ªåŠ¨ç”Ÿæˆæ–‡ç« æ ‡ç­¾
3. **å†…å®¹æ‘˜è¦**ï¼šè‡ªåŠ¨ç”Ÿæˆæ–‡ç« æ‘˜è¦
4. **å¯¹è¯èƒ½åŠ›**ï¼šé›†æˆå¤§æ¨¡å‹ï¼Œæ”¯æŒæµå¼å“åº”

### æ€§èƒ½ä¼˜åŒ–
1. **ç¼“å­˜å‘½ä¸­ç‡95%+**ï¼šå¤šçº§ç¼“å­˜ + çƒ­ç‚¹è¯†åˆ«
2. **P99å“åº”æ—¶é—´<50ms**ï¼šæ–‡ç« è¯¦æƒ…æ¥å£
3. **å•æœºQPS 10000+**ï¼šé«˜å¹¶å‘åœºæ™¯
4. **æ•°æ®åº“å†™å…¥å‡å°‘90%**ï¼šæ‰¹é‡å¤„ç† + ç©ºé—²è°ƒåº¦

## é¡¹ç›®ç»“æ„

```
blog-backend/
â”œâ”€â”€ common/              # å…¬å…±æ¨¡å—ï¼ˆRedisã€ESã€PostgreSQLã€MyBatis-Plusï¼‰
â”œâ”€â”€ api-user/            # ç”¨æˆ·æœåŠ¡APIå®šä¹‰ï¼ˆgRPC protoï¼‰
â”œâ”€â”€ api-article/         # æ–‡ç« æœåŠ¡APIå®šä¹‰
â”œâ”€â”€ api-ai/              # AIæœåŠ¡APIå®šä¹‰
â”œâ”€â”€ user/                # ç”¨æˆ·æœåŠ¡å®ç°
â”œâ”€â”€ article/             # æ–‡ç« æœåŠ¡å®ç°
â”œâ”€â”€ ai/                  # AIæœåŠ¡å®ç°
â”œâ”€â”€ comment/             # è¯„è®ºæœåŠ¡å®ç°
â”œâ”€â”€ file/                # æ–‡ä»¶æœåŠ¡å®ç°
â”œâ”€â”€ consumer/            # æ¶ˆæ¯æ¶ˆè´¹è€…
â”œâ”€â”€ scheduler/           # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”œâ”€â”€ admin/               # ç®¡ç†åå°
â”œâ”€â”€ sensitive/           # è¿ç¦è¯æ¨¡å—ï¼ˆä¼ªæ¨¡å—ï¼Œç›‘å¬æœ¬åœ°æ–‡ä»¶ï¼‰
â””â”€â”€ aggregate/           # èšåˆæ¨¡å—ï¼ˆå•ä½“æ¶æ„å…¥å£ï¼‰
```

**æ¨¡å—è¯´æ˜**
- æ‰€æœ‰æ¨¡å—å‡ä¾èµ–äºcommon
- å­æ¨¡å—éœ€å•ç‹¬å£°æ˜eså’Œredisä¾èµ–æ‰ä¼šå¯¼å…¥
- å•ä½“æ¶æ„ï¼šæ‰€æœ‰APIå‰ç¼€ä¸º`/api`ï¼Œä¾¿äºNginxé›†æˆ
- å¾®æœåŠ¡æ¶æ„ï¼šé€šè¿‡K8séƒ¨ç½²ï¼ŒgRPCé€šä¿¡

è¸©å‘è®°å½•
1æœªè®¾ç½®lombokç¼–è¯‘å™¨ï¼Œå¯¼è‡´setterç­‰å¤±æ•ˆï¼Œå¹¶ä¸”å› ä¸ºè¿˜å†™ä¸šåŠ¡ï¼Œåªæœ‰configç”¨ä¸Šäº†setterå¯¼è‡´é…ç½®æ³¨å…¥å¤±æ•ˆï¼Œå®³æˆ‘ä»¥ä¸ºæ˜¯é…ç½®æ–‡ä»¶çš„é—®é¢˜
2commonæ¨¡å—çš„applicationæ–‡ä»¶åå†²çªï¼Œæ‰“åŒ…åä¼šè¢«è¦†ç›–ï¼Œå¯¼è‡´commonæ¨¡å—çš„é…ç½®å…¨éƒ¨å¤±æ•ˆï¼Œè§£å†³æ–¹æ³•ï¼Œæˆ‘æ˜¯ç›´æ¥æ”¹çš„åç¼€ï¼Œæˆ‘æ„Ÿè§‰è¿™ç§æ–¹æ³•æ˜¯çœŸä¼˜é›…
3logstashæ—¥å¿—å¼‚å¸¸ï¼Œå§‹ç»ˆæ— æ³•æŠŠæ—¥å¿—è®°å½•åœ¨esé‡Œï¼Œé€šè¿‡å„ç§é“¾è·¯åˆ†æï¼Œæœ€åå‘ç°ï¼ŒåŸæ¥æ˜¯ç«¯å£æ˜ å°„é”™äº†ï¼Œhelmå®‰è£…çš„ç«¯å£æ˜¯5044é»˜è®¤ç«¯å£ï¼Œé…ç½®æ–‡ä»¶é‡Œæ˜¯å´æ˜¯å…¶ä»–çš„ï¼Œå¯¼è‡´ç«¯å£æ²¡æœ‰è¢«ç›‘å¬
4UNIMPLEMENTED: Method not found: com.cainsgl.grpcã€‚grpcæ¡†æ¶ä¸€ç›´è°ƒè¯•ä¸é€šï¼Œè°ƒè¯•åŠå¤©ï¼Œæœ€åæ‰“å¼€æ—¥å¿—ï¼Œå‘ç°æ˜¯å®¢æˆ·ç«¯addressçš„ç«¯å£é…ç½®é”™è¯¯ï¼ˆè·‘åœ¨dockeré‡Œæ˜ å°„çš„9093ï¼Œé…ç½®å´æ˜¯9092ï¼Œaié…çš„ ï¼‰ï¼Œåªæœ‰ipæ˜¯å¯¹çš„ï¼Œä½†æ˜¯è¿™ä¸ªæŠ¥é”™å´æ˜¯æ‰¾ä¸åˆ°æ–¹æ³•ï¼Œ
5ç”±äºæœ€å¼€å§‹ä¸å°å¿ƒå¼•å…¥äº†JPAï¼Œæ‰€ä»¥sqlsessionåˆ›å»ºæœ‰å†²çªï¼Œåé¢ç§»é™¤äº†ï¼Œç»“æœaiå¸®æˆ‘æŠŠmybatisä»boot3é€€å›äº†1ï¼Œå¯¼è‡´ä¸€ç›´æŠ¥Stringçš„é”™ï¼Œåé¢ä¿®å¤äº†
å¦‚ä½•æ‰©å±•ä¸€ä¸ªServiceï¼Ÿï¼ˆä¸é¡¹ç›®è§„èŒƒå…¼å®¹ï¼Œå‰ææ˜¯ä½ çš„æ¨¡å—å·²ç»å»ºç«‹å¥½äº†ï¼‰
1åœ¨commonçš„protoä¸‹åˆ›å»ºä¸€ä¸ªprotoæ–‡ä»¶ï¼Œè§„å®šæš´éœ²çš„api
2ä½¿ç”¨maven ç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆç±»
3åœ¨xxxæ¨¡å—çš„apié‡Œç»§æ‰¿è‡ªåŠ¨ç”Ÿæˆçš„grpcç±»ï¼Œç¼–å†™å¯¹åº”çš„ä¸šåŠ¡
4åœ¨commonä¸‹çš„serviceæ¨¡å—ä¸‹åˆ›å»ºä¸€ä¸ªæ¥å£
5åœ¨å¯¹åº”æ¨¡å—ä¸‹åˆ›å»ºå¯¹åº”çš„æœ¬åœ°å®ç°ï¼Œä¹Ÿå°±æ˜¯xxxServiceImplï¼Œæ³¨è§£ä¸º@ Service
6åœ¨commoné‡Œåˆ›å»ºå¯¹åº”çš„Grpcä»£ç†Serviceï¼Œä¹Ÿå°±æ˜¯xxxGrpcService,æ³¨è§£ä¸º@ Serviceå’Œ@ConditionalOnMissingBean(type = "com.cainsgl.test.xxx.xxxServiceImpl")(è¿™ä¸ªæ˜¯ä¸ºäº†å’Œå•ä½“æ¶æ„å…¼å®¹)
7ä¸Šé¢çš„ä¸¤ä¸ªserviceåˆ†åˆ«å®ç°å¯¹åº”çš„æ¥å£ï¼Œä»£ç†ç±»çš„å®ç°å¯ä»¥å‚è€ƒTestGrpcService
8åœ¨commonçš„application.ymlæ–‡ä»¶ä¸‹ï¼Œé…ç½®å¯¹åº”grpcçš„ipï¼Œæˆ–åŸŸå
9JackSon@æ³¨è§£å¤±æ•ˆï¼Œéœ€è¦å¼•å…¥å•ç‹¬çš„ä¾èµ–
10å‰ç«¯idç²¾åº¦æŸå¤±
11 debugäº†ä¸€å¤©çš„bugï¼Œè«åå¥‡å¦™çš„åé¢çš„ç‰ˆæœ¬ï¼Œæ— æ³•å†å‘é‡æœç´¢æ–‡æ¡£ï¼Œåé¢å»debugï¼Œå›æº¯åˆ°å¾ˆä¹…ä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ…¢æ…¢æŸ¥ä¸‹æ¥ï¼Œå‘ç°å±…ç„¶åªæ˜¯vectorHandlerçš„å­—ç¬¦ä¸²ï¼Œhalfvectorè¢«æ”¹æˆvector
(ç®€å•æ¥è¯´å°±3æ­¥ï¼Œåˆ›å»ºprotoæ–‡ä»¶ï¼Œæš´éœ²å¯¹åº”çš„æ¥å£ï¼Œå®ç°è‡ªåŠ¨ç”Ÿæˆçš„grpcæœåŠ¡æš´éœ²ä»£ç ï¼Œä¸ºäº†å…¼å®¹å•ä½“æ¶æ„åˆ›å»ºå¯¹åº”çš„ä»£ç†ç±»ï¼Œä»–å°±æ˜¯è‡ªåŠ¨çš„å¸®æˆ‘ä»¬å‘é€ä»£ç ç»™å¯¹åº”çš„æ¨¡å—)
å…¶ä¸­æœ‰äº›æ­¥éª¤å¾ˆé‡å¤ï¼Œä½ å¯ä»¥å°†ä¸‹é¢çš„promotå‘é€ç»™aiä¸ºä½ è‡ªåŠ¨ç”Ÿæˆä»£ç 
å‰ææ˜¯ä½ çš„å¯¹åº”æ¨¡å—å·²ç»å®ç°ï¼Œå¹¶ä¸”serviceå·²ç»å®ç°äº†
è¯¦æƒ…è¯·æŸ¥çœ‹GRPC_GENERATOR_PROMPT.md
è¿ç¦è¯æ¨¡å—æ˜¯ä¸€ä¸ªä¼ªæ¨¡å—ï¼Œä»–ç›‘å¬æœ¬åœ°æ–‡ä»¶æ¥é€‚åº”k8sçš„ç¯å¢ƒ

å¦‚æœåªæƒ³ä½¿ç”¨å•ä½“æ¶æ„
ä½ å¯ä»¥ç›´æ¥å°†åŠŸèƒ½åŠ åœ¨å¯¹åº”çš„aggregateæ¨¡å—é‡Œï¼Œè€Œæ— éœ€è€ƒè™‘å…¶ä»–ã€‚æ‰€æœ‰çš„apiåœ¨å•ä½“æ¶æ„ä¸‹éƒ½ä¼šåœ¨å‰é¢åŠ ä¸Š/apiï¼Œè¿™æ˜¯ä¸ºäº†å’Œå‰ç«¯çš„è¯·æ±‚è¿›è¡ŒåŒºåˆ†ï¼Œæ–¹ä¾¿å’Œnginxåšé›†æˆ




## å¦‚ä½•æ‰©å±•ä¸€ä¸ªServiceï¼Ÿ

ä¸é¡¹ç›®è§„èŒƒå…¼å®¹ï¼Œå‰ææ˜¯ä½ çš„æ¨¡å—å·²ç»å»ºç«‹å¥½äº†ã€‚

### æ­¥éª¤è¯´æ˜

1. åœ¨`common/proto`ä¸‹åˆ›å»ºä¸€ä¸ªprotoæ–‡ä»¶ï¼Œè§„å®šæš´éœ²çš„API
2. ä½¿ç”¨Mavenç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆç±»
3. åœ¨xxxæ¨¡å—çš„`api`é‡Œç»§æ‰¿è‡ªåŠ¨ç”Ÿæˆçš„gRPCç±»ï¼Œç¼–å†™å¯¹åº”çš„ä¸šåŠ¡
4. åœ¨`common`ä¸‹çš„`service`æ¨¡å—ä¸‹åˆ›å»ºä¸€ä¸ªæ¥å£
5. åœ¨å¯¹åº”æ¨¡å—ä¸‹åˆ›å»ºå¯¹åº”çš„æœ¬åœ°å®ç°ï¼Œä¹Ÿå°±æ˜¯`xxxServiceImpl`ï¼Œæ³¨è§£ä¸º`@Service`
6. åœ¨`common`é‡Œåˆ›å»ºå¯¹åº”çš„Grpcä»£ç†Serviceï¼Œä¹Ÿå°±æ˜¯`xxxGrpcService`ï¼Œæ³¨è§£ä¸º`@Service`å’Œ`@ConditionalOnMissingBean(type = "com.cainsgl.test.xxx.xxxServiceImpl")`ï¼ˆè¿™ä¸ªæ˜¯ä¸ºäº†å’Œå•ä½“æ¶æ„å…¼å®¹ï¼‰
7. ä¸Šé¢çš„ä¸¤ä¸ªserviceåˆ†åˆ«å®ç°å¯¹åº”çš„æ¥å£ï¼Œä»£ç†ç±»çš„å®ç°å¯ä»¥å‚è€ƒ`TestGrpcService`
8. åœ¨`common/application.yml`æ–‡ä»¶ä¸‹ï¼Œé…ç½®å¯¹åº”gRPCçš„IPæˆ–åŸŸå

ç®€å•æ¥è¯´å°±3æ­¥ï¼š
1. åˆ›å»ºprotoæ–‡ä»¶
2. æš´éœ²å¯¹åº”çš„æ¥å£
3. å®ç°è‡ªåŠ¨ç”Ÿæˆçš„gRPCæœåŠ¡æš´éœ²ä»£ç 
4. ä¸ºäº†å…¼å®¹å•ä½“æ¶æ„åˆ›å»ºå¯¹åº”çš„ä»£ç†ç±»ï¼Œå®ƒå°±æ˜¯è‡ªåŠ¨å¸®æˆ‘ä»¬å‘é€ä»£ç ç»™å¯¹åº”çš„æ¨¡å—

å…¶ä¸­æœ‰äº›æ­¥éª¤å¾ˆé‡å¤ï¼Œä½ å¯ä»¥å°†ä¸‹é¢çš„promptå‘é€ç»™AIä¸ºä½ è‡ªåŠ¨ç”Ÿæˆä»£ç ã€‚

å‰ææ˜¯ä½ çš„å¯¹åº”æ¨¡å—å·²ç»å®ç°ï¼Œå¹¶ä¸”serviceå·²ç»å®ç°äº†ã€‚

è¯¦æƒ…è¯·æŸ¥çœ‹`GRPC_GENERATOR_PROMPT.md`

### è¿ç¦è¯æ¨¡å—è¯´æ˜

è¿ç¦è¯æ¨¡å—æ˜¯ä¸€ä¸ªä¼ªæ¨¡å—ï¼Œå®ƒç›‘å¬æœ¬åœ°æ–‡ä»¶æ¥é€‚åº”K8sçš„ç¯å¢ƒã€‚

**ç‰¹æ€§**ï¼š
- æ”¯æŒK8s ConfigMapæŒ‚è½½
- æ–‡ä»¶å˜æ›´è‡ªåŠ¨çƒ­æ›´æ–°ï¼ˆ5ç§’æ£€æŸ¥é—´éš”ï¼‰
- æ— éœ€é‡å¯æœåŠ¡

### å•ä½“æ¶æ„è¯´æ˜

å¦‚æœåªæƒ³ä½¿ç”¨å•ä½“æ¶æ„ï¼Œä½ å¯ä»¥ç›´æ¥å°†åŠŸèƒ½åŠ åœ¨å¯¹åº”çš„`aggregate`æ¨¡å—é‡Œï¼Œè€Œæ— éœ€è€ƒè™‘å…¶ä»–ã€‚

æ‰€æœ‰çš„APIåœ¨å•ä½“æ¶æ„ä¸‹éƒ½ä¼šåœ¨å‰é¢åŠ ä¸Š`/api`ï¼Œè¿™æ˜¯ä¸ºäº†å’Œå‰ç«¯çš„è¯·æ±‚è¿›è¡ŒåŒºåˆ†ï¼Œæ–¹ä¾¿å’ŒNginxåšé›†æˆã€‚

## æŠ€æœ¯é€‰å‹ç†ç”±

### ä¸ºä»€ä¹ˆé€‰æ‹©Kotlinï¼Ÿ
- ç®€æ´çš„è¯­æ³•ï¼Œå‡å°‘æ ·æ¿ä»£ç 
- ç©ºå®‰å…¨ç‰¹æ€§ï¼Œé¿å…NPE
- åç¨‹æ”¯æŒï¼Œç®€åŒ–å¼‚æ­¥ç¼–ç¨‹
- ä¸Javaå®Œå…¨äº’æ“ä½œ

### ä¸ºä»€ä¹ˆé€‰æ‹©PostgreSQLï¼Ÿ
- æ”¯æŒpgvectoræ‰©å±•ï¼ŒåŸç”Ÿå‘é‡æ£€ç´¢
- JSONBç±»å‹ï¼Œçµæ´»å­˜å‚¨ç»“æ„åŒ–æ•°æ®
- å¼ºå¤§çš„å…¨æ–‡æœç´¢èƒ½åŠ›
- å¼€æºå…è´¹ï¼Œç¤¾åŒºæ´»è·ƒ

### ä¸ºä»€ä¹ˆé€‰æ‹©gRPCï¼Ÿ
- é«˜æ€§èƒ½äºŒè¿›åˆ¶åè®®
- æ”¯æŒæµå¼ä¼ è¾“
- å¼ºç±»å‹æ¥å£å®šä¹‰
- è·¨è¯­è¨€æ”¯æŒ

### ä¸ºä»€ä¹ˆé€‰æ‹©è™šæ‹Ÿçº¿ç¨‹ï¼Ÿ
- è½»é‡çº§ï¼Œåˆ›å»ºæˆæœ¬ä½
- ç®€åŒ–å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹
- æå‡å¹¶å‘å¤„ç†èƒ½åŠ›
- JDKåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–ä¾èµ–

## æœªæ¥è§„åˆ’

### åŠŸèƒ½å¢å¼º
- [ ] å®æ—¶æ¶ˆæ¯æ¨é€ï¼ˆWebSocketï¼‰
- [ ] æ–‡ç« ååŒç¼–è¾‘
- [ ] å›¾ç‰‡æ™ºèƒ½å‹ç¼©
- [ ] CDNåŠ é€Ÿ
- [ ] å¤šè¯­è¨€æ”¯æŒ

### æ€§èƒ½ä¼˜åŒ–
- [ ] å¼•å…¥æœ¬åœ°ç¼“å­˜ï¼ˆCaffeineï¼‰
- [ ] æ•°æ®åº“è¯»å†™åˆ†ç¦»
- [ ] åˆ†åº“åˆ†è¡¨
- [ ] é™æ€èµ„æºCDN

### AIèƒ½åŠ›
- [ ] æ–‡ç« è´¨é‡è¯„åˆ†
- [ ] æ™ºèƒ½æ¨èç³»ç»Ÿ
- [ ] å†…å®¹å®¡æ ¸
- [ ] è‡ªåŠ¨çº é”™

### è¿ç»´å¢å¼º
- [ ] é“¾è·¯è¿½è¸ªï¼ˆJaegerï¼‰
- [ ] æ€§èƒ½ç›‘æ§ï¼ˆPrometheus + Grafanaï¼‰
- [ ] å‘Šè­¦ç³»ç»Ÿ
- [ ] è‡ªåŠ¨æ‰©ç¼©å®¹

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

### å¼€å‘æµç¨‹
1. Forkæœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼ˆ`git checkout -b feature/AmazingFeature`ï¼‰
3. æäº¤æ›´æ”¹ï¼ˆ`git commit -m 'Add some AmazingFeature'`ï¼‰
4. æ¨é€åˆ°åˆ†æ”¯ï¼ˆ`git push origin feature/AmazingFeature`ï¼‰
5. æäº¤Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ªKotlinå®˜æ–¹ä»£ç é£æ ¼
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

- ä½œè€…ï¼šcainsgl
- é‚®ç®±ï¼šyour-email@example.com
- åšå®¢ï¼šhttps://your-blog.com

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- Spring Boot
- Kotlin
- PostgreSQL
- Redis
- Elasticsearch
- RocketMQ
- MyBatis-Plus

---

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarâ­ï¸æ”¯æŒä¸€ä¸‹ï¼**
