syntax = "proto3";
package com.cainsgl.grpc;
option java_package = "com.cainsgl.grpc.article";
option java_outer_classname = "ArticleServiceProto";
option java_multiple_files = true;

enum ArticleStatus {
    ARTICLE_STATUS_UNSPECIFIED = 0;
    ARTICLE_STATUS_DRAFT = 1;
    ARTICLE_STATUS_PENDING_REVIEW = 2;
    ARTICLE_STATUS_PUBLISHED = 3;
    ARTICLE_STATUS_OFF_SHELF = 4;
}

message PostEntity {
    int64 id = 1;
    string title = 2;
    string content = 3;
    string summary = 4;
    ArticleStatus status = 5;
    bool top = 6;
    bool recommend = 7;
    int32 view_count = 8;
    int32 like_count = 9;
    int32 comment_count = 10;
    repeated string tags = 11;
    int64 user_id = 12;
    int64 category_id = 13;
    string seo_keywords = 14;
    string seo_description = 15;
    string created_at = 16;
    string updated_at = 17;
    string published_at = 18;
    int64 kb_id = 19;
}


//getById的
message GetPostByIdRequest {
    int64 id = 1;
}

message GetPostByIdResponse {
    bool exists = 1;
    PostEntity post = 2;
}

message GetPostsByIdsRequest {
    repeated int64 ids = 1;
}

message GetPostsByIdsResponse {
    repeated PostEntity posts = 1;
}

//获取文章向量的
message GetVectorByIdRequest{
    int64 id = 1;
}
message GetVectorByIdResponse {
    repeated float float_array = 1;
}

message AddViewCountRequest{
    int64 id=1;
    int32 count=2;
}

service PostService {
    rpc getByIds (GetPostsByIdsRequest) returns (GetPostsByIdsResponse);
    rpc getById (GetPostByIdRequest) returns (GetPostByIdResponse);
    rpc getVectorById (GetVectorByIdRequest) returns(GetVectorByIdResponse);
    rpc addViewCount (AddViewCountRequest) returns (RemoveVectorResponse);
    rpc addCommentCount (AddViewCountRequest) returns (RemoveVectorResponse);
}

message ReloadVectorRequest {
    int64 post_id = 1;
    optional string origin_content = 2;
}

message ReloadVectorResponse {
    bool success = 1;
}

message RemoveVectorRequest {
    int64 post_id = 1;
}
message RemoveVectorResponse {
    bool success = 1;
}




service PostChunkVectorService {
    rpc reloadVector (ReloadVectorRequest) returns (ReloadVectorResponse);
    rpc removeVector (RemoveVectorRequest) returns (RemoveVectorResponse);

}


message PostHistoryEntity {
    int64 id = 1;
    int64 user_id = 2;
    int64 post_id = 3;
    string content = 4;
    string created_at = 5;
    int32 version = 6;
}
//获取文章历史记录的
message GetPostHistoryByIdRequest {
    int64 post_id = 1;
}

message GetPostHistoryByIdResponse {
    bool exists = 1;
    PostHistoryEntity post_history = 2;
}

service PostHistoryService {
    rpc getLastById (GetPostHistoryByIdRequest) returns (GetPostHistoryByIdResponse);
}


message KnowledgeBaseEntity {
    int64 id = 1;
    int64 user_id = 2;
    string name = 3;
    string created_at = 4;
    ArticleStatus status = 5;
    string index = 6;
    int32 like_count = 7;
}

message AddKbLikeCountRequest {
    int64 kb_id = 1;
    int32 add_count = 2;
}

message GetKbsByIdsRequest {
    repeated int64 ids = 1;
}

message GetKbsByIdsResponse {
    repeated KnowledgeBaseEntity kbs = 1;
}

service KnowledgeBaseService {
    rpc addKbLikeCount(AddKbLikeCountRequest) returns (RemoveVectorResponse);
    rpc getByIds (GetKbsByIdsRequest) returns (GetKbsByIdsResponse);
}

