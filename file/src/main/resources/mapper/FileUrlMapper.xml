<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cainsgl.file.repository.FileUrlMapper">
    <!-- 映射 file_urls 表到 FileUrlEntity -->
    <resultMap id="FileUrlResultMap" type="com.cainsgl.common.entity.file.FileUrlEntity">
    </resultMap>
    <!-- 通用列片段 -->
    <sql id="Base_Column_List">
        short_url, user_id, url
    </sql>

    <!-- 统计指定 URL 的引用次数 -->
    <select id="countByUrl" resultType="long">
        SELECT COUNT(*) FROM file_url
        WHERE url = #{url, typeHandler=com.cainsgl.common.handler.ByteaTypeHandler}
    </select>

    <!-- 根据 userId 和 url 查询文件 -->
    <select id="findByUserIdAndUrl" resultType="com.cainsgl.common.entity.file.FileUrlEntity">
        SELECT short_url, user_id, url, name, file_size, created_at
        FROM file_url
        WHERE url = #{url, typeHandler=com.cainsgl.common.handler.ByteaTypeHandler}
        LIMIT 1
    </select>

</mapper>